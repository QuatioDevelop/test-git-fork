{"body":"# ğŸ” Implementar ProtecciÃ³n API con Cognito para Usuarios Admin\n\n## ğŸ“‹ DescripciÃ³n\nImplementar sistema de autenticaciÃ³n basado en AWS Cognito que complemente el sistema JWT existente, estableciendo protecciÃ³n para endpoints `/admin/*` con al menos un usuario admin (super admin) que pueda crear otros usuarios admin.\n\n## ğŸ¯ Objetivos\n- âœ… **Un solo PR** con funcionalidad completa end-to-end\n- âœ… **Desarrollo por commits independientes** (infraestructura â†’ middleware â†’ frontend â†’ testing)\n- âœ… **ImplementaciÃ³n mÃ­nima pero sÃ³lida** preparada para roles futuros\n- âœ… **Sin afectar flujo JWT** de usuarios regulares existente\n\n## ğŸ› ï¸ Componentes de ImplementaciÃ³n\n\n### 1. ğŸ—ï¸ Infraestructura Base\n- [ ] Agregar User Pool Cognito en `iac/backend/template.yaml`\n- [ ] Configurar Identity Pool y roles IAM necesarios  \n- [ ] Definir parÃ¡metros por environment (dev/staging/prod)\n- [ ] Configurar outputs para integraciÃ³n con frontend\n\n### 2. ğŸ”’ Middleware de AutorizaciÃ³n\n- [ ] Crear middleware reutilizable para validar tokens Cognito (`src/utils/auth-middleware.js`)\n- [ ] Aplicar protecciÃ³n a endpoints existentes en `src/admin-rooms.js` (remover comentario TODO)\n- [ ] Estructura extensible para roles futuros (super-admin, admin)\n- [ ] Manejo de errores 401/403 con mensajes claros\n\n### 3. ğŸ‘¥ GestiÃ³n BÃ¡sica de Usuarios (Opcional en MVP)\n- [ ] Endpoint `POST /admin/users` para que super admin cree usuarios admin\n- [ ] Endpoint `GET /admin/users` para listar usuarios admin\n- [ ] Estrategia para crear usuario admin inicial (manual o script)\n- [ ] ValidaciÃ³n de permisos granulares\n\n### 4. ğŸ–¥ï¸ IntegraciÃ³n Frontend\n- [ ] Implementar login Cognito en admin panel (`apps/admin/`)\n- [ ] Manejo de tokens Cognito y localStorage\n- [ ] Redirects automÃ¡ticos para usuarios no autenticados\n- [ ] UI para gestiÃ³n de usuarios admin (si se implementa punto 3)\n\n### 5. ğŸš€ GitHub Actions & Testing\n- [ ] Actualizar permisos CI/CD para desplegar recursos Cognito\n- [ ] Expandir tests existentes en `tests/e2e/admin.spec.ts`:\n  - [ ] Flujo de login con Cognito\n  - [ ] ValidaciÃ³n de acceso a endpoints protegidos\n  - [ ] Manejo de errores de autenticaciÃ³n\n- [ ] Tests unitarios para middleware de autorizaciÃ³n\n\n## ğŸ”— Integraciones Existentes\n- **Endpoints a proteger**: `/admin/rooms/{roomId}/override`, `/admin/rooms/{roomId}/schedule`\n- **Tests base**: `tests/e2e/admin.spec.ts` (expandir, no reescribir)\n- **Infraestructura**: SAM template existente en `iac/backend/template.yaml`\n- **Frontend**: Admin panel en `apps/admin/` (puerto 3001)\n\n## âš¡ Consideraciones TÃ©cnicas\n- **Arquitectura hÃ­brida**: JWT para usuarios regulares + Cognito para admin\n- **No breaking changes**: Sistema JWT actual permanece intacto\n- **Extensibilidad**: Preparado para roles granulares futuros\n- **Security first**: Logging bÃ¡sico de accesos admin para auditorÃ­a\n\n## ğŸ Entregables\n- [ ] âœ… Usuario admin puede acceder a endpoints `/admin/*` con Cognito\n- [ ] âœ… Frontend admin con login Cognito funcional\n- [ ] âœ… Tests E2E actualizados y pasando\n- [ ] âœ… Infraestructura desplegada en dev environment\n- [ ] âœ… DocumentaciÃ³n bÃ¡sica de uso\n\n## ğŸ”„ Criterios de AceptaciÃ³n\n1. **Funcionalidad Core**: Admin puede hacer login con Cognito y acceder a endpoints protegidos\n2. **Seguridad**: Endpoints `/admin/*` rechazan requests sin token Cognito vÃ¡lido\n3. **Frontend**: Admin panel redirige a login si no estÃ¡ autenticado\n4. **Testing**: Tests E2E pasan incluyendo flujos de autenticaciÃ³n\n5. **Deployment**: CI/CD funciona correctamente con nuevos recursos Cognito\n\n## ğŸ“š Referencias\n- **DocumentaciÃ³n API**: `doc/04-api-design.md` (secciÃ³n Admin Panel Cognito)\n- **Arquitectura**: `doc/05-arquitectura-datos.md` \n- **Tests base**: `tests/e2e/admin.spec.ts`\n- **Template SAM**: `iac/backend/template.yaml`\n\n---\n*ImplementaciÃ³n completa en un solo PR con desarrollo incremental por commits*","state":"OPEN","title":"Implementar protecciÃ³n API con Cognito para usuarios admin"}
